<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction â€¢ CohortContrast</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.2.1/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.2.1/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortContrast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a00_introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/a01_execution.html">Execution</a></li>
    <li><a class="dropdown-item" href="../articles/a02_interface.html">Graphical user interface</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction</h1>
            
      

      <div class="d-none name"><code>a00_introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>CohortContrast</strong> package is designed to facilitate
cohort exploration. It accepts a target cohort of any size from your
OMOP CDM instance and allows you to provide a custom control cohort or
generate one using matching or inverse controls. The package performs
concept-level enrichment analysis and provides a handy GUI for
visualization, mapping, and trajectory creation</p>
</div>
<div class="section level2">
<h2 id="initiating-database-connection">Initiating database connection<a class="anchor" aria-label="anchor" href="#initiating-database-connection"></a>
</h2>
<p>We use the <a href="https://cran.r-project.org/web/packages/CDMConnector/index.html" class="external-link">CDMConnector</a>
package is used to establish the database connection. You can configure
the connection either by reading credentials from a
<code>.Renviron</code> file or explicitly writing them in your
script.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Initiate the database connection</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span></span>
<span><span class="va">user</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_USERNAME"</span><span class="op">)</span></span>
<span><span class="va">pw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PASSWORD"</span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_HOST"</span><span class="op">)</span>, <span class="st">"/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_NAME"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">port</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PORT"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdmSchema</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OHDSI_CDM"</span><span class="op">)</span> <span class="co"># Schema which contains the OHDSI Common Data Model</span></span>
<span><span class="va">cdmVocabSchema</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OHDSI_VOCAB"</span><span class="op">)</span> <span class="co"># Schema which contains the OHDSI Common Data Model vocabulary tables.</span></span>
<span><span class="va">cdmResultsSchema</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OHDSI_RESULTS"</span><span class="op">)</span> <span class="co"># Schema which contains "cohort" table (is not mandatory)</span></span>
<span><span class="va">writeSchema</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"OHDSI_WRITE"</span><span class="op">)</span> <span class="co"># Schema for temporary tables, will be deleted</span></span>
<span><span class="va">writePrefix</span> <span class="op">&lt;-</span> <span class="st">"cc_"</span></span>
<span></span>
<span><span class="va">db</span> <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">Postgres</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_NAME"</span><span class="op">)</span>,</span>
<span>  host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_HOST"</span><span class="op">)</span>,</span>
<span>  user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_USERNAME"</span><span class="op">)</span>,</span>
<span>  password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"DB_PASSWORD"</span><span class="op">)</span>,</span>
<span>  port  <span class="op">=</span> <span class="va">port</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdm_from_con.html" class="external-link">cdmFromCon</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="va">cdmSchema</span>,</span>
<span>  achillesSchema <span class="op">=</span> <span class="va">cdmResultsSchema</span>,</span>
<span>  writeSchema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="va">writeSchema</span>, prefix <span class="op">=</span> <span class="va">writePrefix</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-a-target-cohort">Building a target cohort<a class="anchor" aria-label="anchor" href="#building-a-target-cohort"></a>
</h2>
<p>LetÂ´s say we want to explore our cohort of breast cancer patients. We
can import this target cohort multiple ways:</p>
<div class="section level3">
<h3 id="target-cohort-from-ohdsi-omop-database-">1. Target cohort from OHDSI OMOP database.<a class="anchor" aria-label="anchor" href="#target-cohort-from-ohdsi-omop-database-"></a>
</h3>
<p>If your cohort is defined in ATLAS, you can use its unique cohort ID.
Ensure the cohort is generated within ATLAS on the CDM instance.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create target table from OMOP CDM instance (ATLAS's cohort id)</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span></span>
<span><span class="va">cohortsTableName</span> <span class="op">=</span> <span class="st">'cohort'</span></span>
<span><span class="va">targetCohortId</span> <span class="op">=</span> <span class="fl">1403</span></span>
<span></span>
<span><span class="va">targetTable</span> <span class="op">&lt;-</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/cohortFromCohortTable.html">cohortFromCohortTable</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, db <span class="op">=</span> <span class="va">db</span>,</span>
<span>   tableName <span class="op">=</span> <span class="va">cohortsTableName</span>, schemaName <span class="op">=</span> <span class="va">cdmResultsSchema</span>, cohortId <span class="op">=</span> <span class="va">targetCohortId</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="target-cohort-from-json-description-file-">2. Target cohort from JSON description file.<a class="anchor" aria-label="anchor" href="#target-cohort-from-json-description-file-"></a>
</h3>
<p>If you have the JSON expression of the cohort (exportable from
ATLAS), you can import the cohort directly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create target table from a JSON</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span> <span class="va">pathToJSON</span> <span class="op">=</span> <span class="st">'/Users/markushaug/UT/R-packages/Develop/Git/CohortContrast/tests/testthat/inst/JSON'</span></span>
<span> <span class="va">targetTable</span> <span class="op">&lt;-</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/cohortFromJSON.html">cohortFromJSON</a></span><span class="op">(</span>pathToJSON <span class="op">=</span> <span class="va">pathToJSON</span>, <span class="va">cdm</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="target-cohort-from-a-csv-file-">3. Target cohort from a CSV file.<a class="anchor" aria-label="anchor" href="#target-cohort-from-a-csv-file-"></a>
</h3>
<p>We can import the target table from a CSV. The file should have the
same columns as present inside a cohort table (cohort_definition_id,
subject_id, cohort_start_date, cohort_end_date).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create target table from a CSV</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span><span class="va">pathToCsv</span> <span class="op">=</span> <span class="st">'/Users/markushaug/UT/R-packages/Develop/Git/CohortContrast/tests/testthat/inst/CSV/cohort/cohort.csv'</span></span>
<span><span class="va">targetTable</span> <span class="op">&lt;-</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/cohortFromCSV.html">cohortFromCSV</a></span><span class="op">(</span>pathToCsv <span class="op">=</span> <span class="va">pathToCsv</span>, cohortId <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="target-cohort-from-a-table">4. Target cohort from a table<a class="anchor" aria-label="anchor" href="#target-cohort-from-a-table"></a>
</h3>
<p>We can also use a table in our memory.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create target table</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="co">#Create the dataframe</span></span>
<span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>   <span class="op">~</span><span class="va">cohort_definition_id</span>, <span class="op">~</span><span class="va">subject_id</span>, <span class="op">~</span><span class="va">cohort_start_date</span>, <span class="op">~</span><span class="va">cohort_end_date</span>,</span>
<span>   <span class="fl">1</span>, <span class="fl">4804</span>, <span class="st">'1997-03-23'</span>, <span class="st">'2018-10-29'</span>,</span>
<span>   <span class="fl">1</span>, <span class="fl">4861</span>, <span class="st">'1982-06-02'</span>, <span class="st">'2019-05-23'</span>,</span>
<span>   <span class="fl">1</span>, <span class="fl">1563</span>, <span class="st">'1977-06-25'</span>, <span class="st">'2019-04-20'</span>,</span>
<span>   <span class="fl">1</span>, <span class="fl">2830</span>, <span class="st">'2006-08-11'</span>, <span class="st">'2019-01-14'</span>,</span>
<span>   <span class="fl">1</span>, <span class="fl">1655</span>, <span class="st">'2004-09-29'</span>, <span class="st">'2019-05-24'</span>,</span>
<span>   <span class="fl">2</span>, <span class="fl">5325</span>, <span class="st">'1982-06-02'</span>, <span class="st">'2019-03-17'</span>,</span>
<span>   <span class="fl">2</span>, <span class="fl">3743</span>, <span class="st">'1997-03-23'</span>, <span class="st">'2018-10-07'</span>,</span>
<span>   <span class="fl">2</span>, <span class="fl">2980</span>, <span class="st">'2004-09-29'</span>, <span class="st">'2018-04-01'</span>,</span>
<span>   <span class="fl">2</span>, <span class="fl">1512</span>, <span class="st">'2006-08-11'</span>, <span class="st">'2017-11-29'</span>,</span>
<span>   <span class="fl">2</span>, <span class="fl">2168</span>, <span class="st">'1977-06-25'</span>, <span class="st">'2018-11-22'</span></span>
<span><span class="op">)</span></span>
<span><span class="va">targetTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cohortFromDataTable.html">cohortFromDataTable</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, cohortId <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>For cases 2-4 you do not have to specify the <code>cohortId</code>
parameter inside the function call, but when multiple cohorts present it
is advised.</p>
</div>
</div>
<div class="section level2">
<h2 id="building-a-control-cohort">Building a control cohort<a class="anchor" aria-label="anchor" href="#building-a-control-cohort"></a>
</h2>
<p>The control cohort is a cohort that the target cohort is compared
against. This means we will check the proportions of each concept
occurrence between the two cohorts. The result of the analysis is
heavily dependant on both of them, therefore they should be selected
with care.</p>
<p>The control cohort can be generated the same way the target cohort
has been shown to be generated in examples 1-4. But there are a few
automatic ways the package <code>CohortContrast</code> provides:</p>
<div class="section level3">
<h3 id="control-cohort-based-on-matches">1. Control cohort based on matches<a class="anchor" aria-label="anchor" href="#control-cohort-based-on-matches"></a>
</h3>
<p>One of the scientific approaches is to select matches from the
database (based on age and sex). There are parameters such as
<code>ratio</code> which shown how many controls we want for each case.
Also <code>min</code> (at least that many matches error otherwise) and
<code>max</code> (at maximum n matches) parameters can be used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create control cohort table based on matches</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span><span class="va">controlTable</span> <span class="op">=</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/createControlCohortMatching.html">createControlCohortMatching</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, targetTable <span class="op">=</span> <span class="va">targetTable</span>, ratio <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="control-cohort-based-on-inverse-controls">2. Control cohort based on inverse controls<a class="anchor" aria-label="anchor" href="#control-cohort-based-on-inverse-controls"></a>
</h3>
<p>Sometimes it makes the most sense to use inverse controls (the same
subjects during observation period not described in target cohort). This
is the case for example if we want to see the contrast after a
diagnosis.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Create control cohort table based on inverse controls</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span><span class="va">controlTable</span> <span class="op">=</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/createControlCohortInverse.html">createControlCohortInverse</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, targetTable <span class="op">=</span> <span class="va">targetTable</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-considerations">Other considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h2>
<p>If you have constructed the cohorts by hand it is strongly advised to
check and resolve overlap conflicts as well as conflicts with
observation period inside the OMOP CDM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">################################################################################</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Resolve conflicts</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#################################################################################</span></span>
<span><span class="va">targetTable</span> <span class="op">=</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/resolveCohortTableOverlaps.html">resolveCohortTableOverlaps</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, cohortTable <span class="op">=</span> <span class="va">targetTable</span><span class="op">)</span></span>
<span><span class="va">controlTable</span> <span class="op">=</span> <span class="fu">CohortContrast</span><span class="fu">::</span><span class="fu"><a href="../reference/resolveCohortTableOverlaps.html">resolveCohortTableOverlaps</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, cohortTable <span class="op">=</span> <span class="va">controlTable</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Markus Haug, Raivo Kolde.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
